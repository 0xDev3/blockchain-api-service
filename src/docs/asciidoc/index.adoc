= AMPnet Blockchain API Service Documentation
Version {version}, {date}
:doctype: book
:toc: left
:sectnums:
:toclevels: 2
:source-highlighter: prettify
:docinfo: shared
:icons: font

== Introduction
This document contains generated documentation for `AMPnet blockchain-api-service`. Blockchain API service provides
endpoints to verify user wallet ownership as well as endpoints to fetch data from blockchain for verified wallets.
Source code is available on https://github.com/AMPnet/blockchain-api-service[Github].

== Verification API
All endpoints are public and do not require `Authorization: Bearer JWT` header.

=== Generate verification message
Generates new verification message which must be signed by the user to verify wallet address ownership. Path argument
is the user wallet address.

.Request
include::{snippets}/VerificationControllerApiTest/mustCorrectlyGenerateVerificationMessageAndStoreItInDatabase/http-request.adoc[]
.Response
include::{snippets}/VerificationControllerApiTest/mustCorrectlyGenerateVerificationMessageAndStoreItInDatabase/http-response.adoc[]

=== Verify message signature
Verifies verification message signature. Path argument is the message ID.

.Request
include::{snippets}/VerificationControllerApiTest/mustCorrectlyVerifyValidMessageSignature/http-request.adoc[]
.Response
include::{snippets}/VerificationControllerApiTest/mustCorrectlyVerifyValidMessageSignature/http-response.adoc[]

== Blockchain Into API
All endpoints are public and do not require `Authorization: Bearer JWT` header. Custom RPC URL can be specified via
optional `X-RPC-URL` header - this will override the default RPC URL for the specified chain ID.

=== Fetch ERC20 balance for verified account
Fetches ERC20 balance of specified contract address for the account which signed verification message with given ID.
Chain ID, message ID and contract address are provided as path arguments, in that order. Block number can be provided as
an optional query parameter `blockNumber`.

.Request
include::{snippets}/BlockchainInfoControllerApiTest/mustCorrectlyFetchErc20Balance/http-request.adoc[]
.Response
include::{snippets}/BlockchainInfoControllerApiTest/mustCorrectlyFetchErc20Balance/http-response.adoc[]

== Send ERC20 Request API
All endpoints are public and do not require `Authorization: Bearer JWT` header.

=== Create Send ERC20 Request
Creates send ERC20 request with specified parameters. Either `client_id` or both `chain_id` and `redirect_url` must be
provided as request body parameters. `from_address`, `arbitrary_data`, `screen_config` and all its child fields are
optional. `arbitrary_data` field can contain any desired JSON value.

Example request using `client_id` field:

.Request
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyCreateSendErc20RequestViaClientId/http-request.adoc[]
.Response
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyCreateSendErc20RequestViaClientId/http-response.adoc[]

Example request using `chain_id` and `redirect_url` fields:

.Request
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyCreateSendErc20RequestViaChainIdAndRedirectUrl/http-request.adoc[]
.Response
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyCreateSendErc20RequestViaChainIdAndRedirectUrl/http-response.adoc[]

=== Fetch Send ERC20 Request by ID
Fetches stored send ERC20 request with its current status. Possible statuses are `PENDING`, `SUCCESS` and `FAILED`. The
request is considered successful if the attached transaction is confirmed on blockchain and all its data matches
specified request parameters (correct `to` and `from` addresses, `amount`, matching `data` and `txHash`). If there are
any mismatches between specified request data and state on blockchain, the request will be marked as failed. If there is
no attached transaction hash or if transaction for attached hash is not yet mined on blockchain, request will be in
pending state.

Custom RPC URL can be specified via optional `X-RPC-URL` header - this will override the default RPC URL for the
specified chain ID.

.Request
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyFetchSendErc20Request/http-request.adoc[]
.Response
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyFetchSendErc20Request/http-response.adoc[]

=== Attach Transaction Hash to Send ERC20 Request
Attaches transaction hash to existing send ERC20 request. Once the transaction hash is attached to the request, any
subsequent attempts to attach a new transaction hash will fail.

.Request
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyAttachTransactionHash/http-request.adoc[]
.Response
include::{snippets}/SendErc20RequestControllerApiTest/mustCorrectlyAttachTransactionHash/http-response.adoc[]
